
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.9. Pandas merge &#8212; Introduction to Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/myfile.css?v=564be945" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter_05/ENDG440_C05S09';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.10. Pandas join and concat" href="ENDG440_C05S10.html" />
    <link rel="prev" title="5.8. Strategies for Handling Missing Categorical Data in Pandas" href="ENDG440_C05S08.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../Preface.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Introduction to Python - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Introduction to Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_01/ENDG440_C01.html">1. Fundamental Concepts of Python Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S01.html">1.1. Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S02.html">1.2. Data Types: A brief overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S03.html">1.3. Operations in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S04.html">1.4. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S05.html">1.5. Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S06.html">1.6. Conditionals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S07.html">1.7. Recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S08.html">1.8. Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S09.html">1.9. Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S10.html">1.10. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S11.html">1.11. Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S12.html">1.12. Special Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_01/ENDG440_C01S13.html">1.13. Functions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_02/ENDG440_C02.html">2. Data Structures and File Handling in Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_02/ENDG440_C02S01.html">2.1. Strings in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_02/ENDG440_C02S02.html">2.2. String Formatting Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_02/ENDG440_C02S03.html">2.3. Python Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_02/ENDG440_C02S04.html">2.4. Dictionaries in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_02/ENDG440_C02S05.html">2.5. Python Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_02/ENDG440_C02S06.html">2.6. Python Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_02/ENDG440_C02S07.html">2.7. Files in Python</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_03/ENDG440_C03.html">3. Classes and Objects</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_03/ENDG440_C03S01.html">3.1. Introduction to Classes and Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_03/ENDG440_C03S02.html">3.2. Inheritance and Polymorphism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_03/ENDG440_C03S03.html">3.3. Encapsulation and Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_03/ENDG440_C03S04.html">3.4. Copying Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_03/ENDG440_C03S05.html">3.5. Magic Methods (Dunder Methods) in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_03/ENDG440_C03S06.html">3.6. Examples of Classes</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_04/ENDG440_C04.html">4. Introduction to NumPy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_04/ENDG440_C04S01.html">4.1. Basics of Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_04/ENDG440_C04S02.html">4.2. NumPy Function Reference and Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_04/ENDG440_C04S03.html">4.3. Advanced Numpy Concepts</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="ENDG440_C05.html">5. Working with Data using Pandas</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S01.html">5.1. An Introduction to Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S02.html">5.2. DataFrame and Series Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S03.html">5.3. Pandas Data Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S04.html">5.4. Modifying a DataFrame in Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S05.html">5.5. Handling Missing Data in Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S06.html">5.6. Filling Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S07.html">5.7. Techniques for Filling Missing Data in Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S08.html">5.8. Strategies for Handling Missing Categorical Data in Pandas</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.9. Pandas <code class="docutils literal notranslate"><span class="pre">merge</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S10.html">5.10. Pandas <code class="docutils literal notranslate"><span class="pre">join</span></code> and <code class="docutils literal notranslate"><span class="pre">concat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S11.html">5.11. Aggregation and Grouping in Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="ENDG440_C05S12.html">5.12. Pandas pivot and melt</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_06/ENDG440_C06.html">6. Data Visualization using Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_06/ENDG440_C06S01.html">6.1. Getting Started with Matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_06/ENDG440_C06S02.html">6.2. Matplotlib Styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_06/ENDG440_C06S03.html">6.3. Matplotlib interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_06/ENDG440_C06S04.html">6.4. Marker, Linestyles and Colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_06/ENDG440_C06S05.html">6.5. Seaborn plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_06/ENDG440_C06S06.html">6.6. Python Plotting Guide</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../References.html">7. References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Pandas merge</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-merge">5.9.1. Inner Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outer-merge">5.9.2. Outer Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#left-merge">5.9.3. Left Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#right-merge">5.9.4. Right Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-join">5.9.5. Cross Join</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-key-merging">5.9.6. Multi-Key Merging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-left-and-right-prefixes">5.9.7. Specifying Left and Right Prefixes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-on-index">5.9.8. Merging on Index</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-and-filtering-dataframes-in-pandas-using-merge-and-query">5.9.9. Merging and Filtering DataFrames in Pandas using merge() and query()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-join-and-anti-join">5.9.10. Semi-join and Anti-join</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-on-nearest-key">5.9.11. Merge on Nearest Key</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-merging">5.9.12. Categorical Merging</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pandas-merge">
<h1><span class="section-number">5.9. </span>Pandas <code class="docutils literal notranslate"><span class="pre">merge</span></code><a class="headerlink" href="#pandas-merge" title="Link to this heading">#</a></h1>
<p>Within the Pandas library, <code class="docutils literal notranslate"><span class="pre">merge</span></code>, <code class="docutils literal notranslate"><span class="pre">join</span></code>, and <code class="docutils literal notranslate"><span class="pre">concat</span></code> are fundamental functions that play a pivotal role in combining and merging data from various DataFrames. The <code class="docutils literal notranslate"><span class="pre">merge</span></code> function, in particular, facilitates the merging of two DataFrames based on common columns or indices, resembling the behavior of SQL joins. By specifying the <code class="docutils literal notranslate"><span class="pre">on</span></code> parameter, you can identify the shared column(s) for merging. This function supports various types of joins, such as inner, left, right, and outer joins. Here’s how you can use the <code class="docutils literal notranslate"><span class="pre">merge</span></code> function <span id="id1">[<a class="reference internal" href="../References.html#id51" title="Pandas Developers. Pandas documentation. https://pandas.pydata.org/docs/, 2023. [Online; accessed 01-August-2023].">Pandas Developers, 2023</a>]</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">left_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="s1">&#39;_y&#39;</span><span class="p">),</span>
         <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Parameters Explained:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">left</span></code></strong>: The left DataFrame to be merged.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">right</span></code></strong>: The right DataFrame to be merged.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">how</span></code></strong>: The type of join to perform. Options include:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'inner'</span></code>: Only include rows with keys present in both DataFrames.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'outer'</span></code>: Include rows with keys from either DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'left'</span></code>: Include all rows from the left DataFrame and matching rows from the right DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'right'</span></code>: Include all rows from the right DataFrame and matching rows from the left DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'cross'</span></code>: Perform a Cartesian product of rows from both DataFrames.</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">on</span></code></strong>: Column(s) to join on. It can be a single column name or a list of column names.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">left_on</span></code></strong>: Column(s) from the left DataFrame to use as join keys.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">right_on</span></code></strong>: Column(s) from the right DataFrame to use as join keys.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">left_index</span></code></strong>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, use the left DataFrame’s index as a join key.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">right_index</span></code></strong>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, use the right DataFrame’s index as a join key.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">sort</span></code></strong>: Sort the result DataFrame by the join keys.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">suffixes</span></code></strong>: Suffixes to add to overlapping column names from both DataFrames.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">copy</span></code></strong>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, creates copies of input data.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">indicator</span></code></strong>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, adds a column to indicate the source of each row.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">validate</span></code></strong>: Validates the merge keys. Options include:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'one_to_one'</span></code>: Ensure that each key combination appears only once in both DataFrames.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'one_to_many'</span></code>: Ensure that each key combination appears only once in the left DataFrame and multiple times in the right DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'many_to_one'</span></code>: Ensure that each key combination appears multiple times in the left DataFrame and only once in the right DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'many_to_many'</span></code>: Allow multiple appearances of each key combination in both DataFrames.</p></li>
</ul>
</li>
</ul>
<p>For a comprehensive understanding of the function, you may refer to the complete documentation available <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">here</a>.</p>
<p>These are the different types of merge operations that you can specify when combining dataframes using the <code class="docutils literal notranslate"><span class="pre">merge()</span></code> function in pandas <span id="id2">[<a class="reference internal" href="../References.html#id138" title="W. McKinney. Python for Data Analysis. O'Reilly Media, 2022. ISBN 9781098104009. URL: https://books.google.ca/books?id=EgKBEAAAQBAJ.">McKinney, 2022</a>]</span>:</p>
<figure class="align-center" id="merge-types-fig">
<a class="reference internal image-reference" href="../_images/join_how.jpg"><img alt="../_images/join_how.jpg" src="../_images/join_how.jpg" style="width: 700px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.17 </span><span class="caption-text">Various types of circle overlaps and connections: <strong>Left:</strong> Two circles overlapping slightly on the left side. <strong>Right:</strong> Two circles overlapping slightly on the right side. <strong>Outer:</strong> Two circles with a larger overlap in the middle. <strong>Inner:</strong> One small circle entirely within a larger circle. <strong>Cross:</strong> Three pairs of numbers (1-1, 2-2, 3-3) connected by lines in a star or cross-like pattern within an encompassing circle.</span><a class="headerlink" href="#merge-types-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="inner-merge">
<h2><span class="section-number">5.9.1. </span>Inner Merge<a class="headerlink" href="#inner-merge" title="Link to this heading">#</a></h2>
<p>An inner merge in pandas returns only the rows where the keys (columns used for merging) exist in both dataframes. Think of it as finding the common ground between two datasets. For example, if you have two dataframes, one with employee names and IDs, and another with employee IDs and ages, an inner merge on the ID column will give you a dataframe that includes only the employees who appear in both dataframes, along with their names and ages.</p>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Create two DataFrames</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,],</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Charlie&#39;</span><span class="p">]})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;Age&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">22</span><span class="p">]})</span>

<span class="c1"># Display the original DataFrames</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Perform an inner merge on &#39;ID&#39; column</span>
<span class="n">inner_merged</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Display the result of the inner merge</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mergerd df:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">inner_merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Bob</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Charlie</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mergerd df:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>Bob</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>Charlie</td>
      <td>30</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a class="reference internal" href="#pandas-merge-inner-example1"><span class="std std-numref">Fig. 5.18</span></a> illustrates the IDs present in two datasets, df1 and df2. The overlap shows IDs common to both datasets (2, 3), while the non-overlapping sections display unique IDs for each dataset (1 for df1 and 4 for df2). The merge using using <code class="docutils literal notranslate"><span class="pre">inner</span></code> is demonstrated.</p>
<figure class="align-center" id="pandas-merge-inner-example1">
<a class="reference internal image-reference" href="../_images/pandas_merge_inner_example1.jpg"><img alt="../_images/pandas_merge_inner_example1.jpg" src="../_images/pandas_merge_inner_example1.jpg" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.18 </span><span class="caption-text">Visualizing the inner merge for the above example.</span><a class="headerlink" href="#pandas-merge-inner-example1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="outer-merge">
<h2><span class="section-number">5.9.2. </span>Outer Merge<a class="headerlink" href="#outer-merge" title="Link to this heading">#</a></h2>
<p>An outer merge, on the other hand, is more inclusive. It returns all rows from both dataframes, filling in missing values with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> where there are no matches. This type of merge is useful when you want to combine all data from both sources, even if some entries don’t have corresponding matches. For instance, if one dataframe lists all employees and another lists only those who have completed a training program, an outer merge will show all employees, indicating who has completed the training and who hasn’t.</p>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the original DataFrames</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Perform an outer merge on &#39;ID&#39; and store the result in &#39;outer_merged&#39;</span>
<span class="n">outer_merged</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>

<span class="c1"># Display the result of the outer merge</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merged DataFrame:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">outer_merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Bob</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Charlie</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df2:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged DataFrame:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Bob</td>
      <td>25.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Charlie</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>NaN</td>
      <td>22.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a class="reference internal" href="#pandas-merge-outer-example1"><span class="std std-numref">Fig. 5.19</span></a> illustrates the IDs present in two datasets, df1 and df2. The overlap shows IDs common to both datasets (2, 3), while the non-overlapping sections display unique IDs for each dataset (1 for df1 and 4 for df2). The merge using using <code class="docutils literal notranslate"><span class="pre">outer</span></code> is demonstrated.</p>
<figure class="align-center" id="pandas-merge-outer-example1">
<a class="reference internal image-reference" href="../_images/pandas_merge_outer_example1.jpg"><img alt="../_images/pandas_merge_outer_example1.jpg" src="../_images/pandas_merge_outer_example1.jpg" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.19 </span><span class="caption-text">Visualizing the outer merge for the above example.</span><a class="headerlink" href="#pandas-merge-outer-example1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="left-merge">
<h2><span class="section-number">5.9.3. </span>Left Merge<a class="headerlink" href="#left-merge" title="Link to this heading">#</a></h2>
<p>A left merge focuses on retaining all rows from the left dataframe and matching them with rows from the right dataframe where possible. If a key exists in the left dataframe but not in the right, the resulting dataframe will still include the left dataframe’s rows, with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> filling in for missing values from the right dataframe. This is particularly useful when you have a primary dataset and want to enrich it with additional information from another dataset, without losing any of the original data.</p>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the original DataFrames</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Perform a left merge on &#39;ID&#39; and store the result in &#39;left_merged&#39;</span>
<span class="n">left_merged</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="c1"># Display the result of the left merge</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merged DataFrame:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">left_merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Bob</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Charlie</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df2:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged DataFrame:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Bob</td>
      <td>25.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Charlie</td>
      <td>30.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a class="reference internal" href="#pandas-merge-left-example1"><span class="std std-numref">Fig. 5.20</span></a> illustrates the IDs present in two datasets, df1 and df2. The overlap shows IDs common to both datasets (2, 3), while the non-overlapping sections display unique IDs for each dataset (1 for df1 and 4 for df2). The merge using using <code class="docutils literal notranslate"><span class="pre">left</span></code> is demonstrated.</p>
<figure class="align-center" id="pandas-merge-left-example1">
<a class="reference internal image-reference" href="../_images/pandas_merge_left_example1.jpg"><img alt="../_images/pandas_merge_left_example1.jpg" src="../_images/pandas_merge_left_example1.jpg" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.20 </span><span class="caption-text">Visualizing the left merge for the above example.</span><a class="headerlink" href="#pandas-merge-left-example1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="right-merge">
<h2><span class="section-number">5.9.4. </span>Right Merge<a class="headerlink" href="#right-merge" title="Link to this heading">#</a></h2>
<p>The right merge is similar to the left merge but works in the opposite direction. It keeps all rows from the right dataframe and includes matching rows from the left dataframe. If a key exists in the right dataframe but not in the left, the resulting dataframe will include the right dataframe’s rows, with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> filling in for missing values from the left dataframe. This is handy when the right dataframe is your primary dataset and you want to add information from the left dataframe.</p>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the original DataFrames</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Perform a right merge on &#39;ID&#39; and store the result in &#39;right_merged&#39;</span>
<span class="n">right_merged</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># Display the result of the right merge</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merged DataFrame:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">right_merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Bob</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Charlie</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df2:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged DataFrame:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>Bob</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>Charlie</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>NaN</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a class="reference internal" href="#pandas-merge-right-example1"><span class="std std-numref">Fig. 5.21</span></a> illustrates the IDs present in two datasets, df1 and df2. The overlap shows IDs common to both datasets (2, 3), while the non-overlapping sections display unique IDs for each dataset (1 for df1 and 4 for df2). The merge using using <code class="docutils literal notranslate"><span class="pre">right</span></code> is demonstrated.</p>
<figure class="align-center" id="pandas-merge-right-example1">
<a class="reference internal image-reference" href="../_images/pandas_merge_right_example1.jpg"><img alt="../_images/pandas_merge_right_example1.jpg" src="../_images/pandas_merge_right_example1.jpg" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.21 </span><span class="caption-text">Visualizing the right merge for the above example.</span><a class="headerlink" href="#pandas-merge-right-example1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="cross-join">
<h2><span class="section-number">5.9.5. </span>Cross Join<a class="headerlink" href="#cross-join" title="Link to this heading">#</a></h2>
<p>A cross join, also known as a Cartesian product, combines every row from the first dataframe with every row from the second dataframe. This results in a dataframe where the number of rows is the product of the number of rows in both input dataframes. While this can generate a large number of rows, it’s useful in scenarios where you need to pair each item from one dataset with every item from another, such as creating all possible combinations of products and stores for a sales analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the original DataFrames</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Perform a cross merge on &#39;ID&#39; and store the result in &#39;cross_join&#39;</span>
<span class="n">cross_join</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_df1&#39;</span><span class="p">,</span> <span class="s1">&#39;_df2&#39;</span><span class="p">))</span>

<span class="c1"># Display the result of the cross join</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merged DataFrame:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">cross_join</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Bob</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Charlie</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df2:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged DataFrame:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID_df1</th>
      <th>Name</th>
      <th>ID_df2</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alice</td>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Alice</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>Alice</td>
      <td>4</td>
      <td>22</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>Bob</td>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>Bob</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>Bob</td>
      <td>4</td>
      <td>22</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3</td>
      <td>Charlie</td>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3</td>
      <td>Charlie</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3</td>
      <td>Charlie</td>
      <td>4</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="pst-scrollable-table-container"><table class="table" id="tablec0509-01">
<caption><span class="caption-number">Table 5.5 </span><span class="caption-text">Summary of Merge Types</span><a class="headerlink" href="#tablec0509-01" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Merge Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'inner'</span></code></p></td>
<td><p>Retains rows with matching keys in both dataframes.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">'outer'</span></code></p></td>
<td><p>Retains all rows, filling in missing values with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> for non-matching keys.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'left'</span></code></p></td>
<td><p>Retains all rows from the left dataframe and matches them with rows from the right dataframe.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">'right'</span></code></p></td>
<td><p>Retains all rows from the right dataframe and matches them with rows from the left dataframe.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'cross'</span></code></p></td>
<td><p>Generates a new dataframe with all possible combinations of rows from both dataframes.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition-set-theory-notation-for-joins admonition">
<p class="admonition-title">Set Theory Notation for Joins</p>
<ol class="arabic simple">
<li><p><strong>Inner Join:</strong></p>
<ul class="simple">
<li><p>Set Theory: A ∩ B</p></li>
<li><p>Description: Includes rows that have matching values in both A and B.</p></li>
</ul>
</li>
<li><p><strong>Outer Join (Full Outer Join):</strong></p>
<ul class="simple">
<li><p>Set Theory: A ∪ B</p></li>
<li><p>Description: Includes all rows from both A and B, with missing values for non-matching rows.</p></li>
</ul>
</li>
<li><p><strong>Left Join:</strong></p>
<ul class="simple">
<li><p>Set Theory: A ∪ (A ∩ B)</p></li>
<li><p>Description: Includes all rows from A and only the matching rows from B.</p></li>
</ul>
</li>
<li><p><strong>Right Join:</strong></p>
<ul class="simple">
<li><p>Set Theory: B ∪ (A ∩ B)</p></li>
<li><p>Description: Includes all rows from B and only the matching rows from A.</p></li>
</ul>
</li>
<li><p><strong>Cross Join (Cartesian Join):</strong></p>
<ul class="simple">
<li><p>Set Theory: A × B</p></li>
<li><p>Description: Creates all possible combinations of rows from A and B.</p></li>
</ul>
</li>
<li><p><strong>Semi-Join (Left or Right):</strong></p>
<ul class="simple">
<li><p>Set Theory: A ∩ B</p></li>
<li><p>Description: Includes rows from one DataFrame (A or B) that have matching values in the other DataFrame.</p></li>
</ul>
</li>
<li><p><strong>Anti-Join:</strong></p>
<ul class="simple">
<li><p>Set Theory: B - (A ∩ B)</p></li>
<li><p>Description: Includes rows from B that do not have matching values in A.</p></li>
</ul>
</li>
</ol>
<p><a class="reference internal" href="#tablec0509-02"><span class="std std-numref">Table 5.6</span></a> summarizes the various types of joins using set theory notation and provides brief descriptions of each join operation.</p>
<div class="pst-scrollable-table-container"><table class="table" id="tablec0509-02">
<caption><span class="caption-number">Table 5.6 </span><span class="caption-text">Summary of the various types of joins</span><a class="headerlink" href="#tablec0509-02" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Join Type</p></th>
<th class="head"><p>Notation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Inner Join</p></td>
<td><p>A ∩ B</p></td>
<td><p>Rows with matching values in both A and B</p></td>
</tr>
<tr class="row-odd"><td><p>Outer Join</p></td>
<td><p>A ∪ B</p></td>
<td><p>All rows from both A and B, with missing values</p></td>
</tr>
<tr class="row-even"><td><p>Left Join</p></td>
<td><p>A ∪ (A ∩ B)</p></td>
<td><p>All rows from A, only matching rows from B</p></td>
</tr>
<tr class="row-odd"><td><p>Right Join</p></td>
<td><p>B ∪ (A ∩ B)</p></td>
<td><p>All rows from B, only matching rows from A</p></td>
</tr>
<tr class="row-even"><td><p>Cross Join</p></td>
<td><p>A × B</p></td>
<td><p>All possible combinations of rows from A and B</p></td>
</tr>
<tr class="row-odd"><td><p>Semi-Join</p></td>
<td><p>A ∩ B</p></td>
<td><p>Rows from one DataFrame (A or B) with matching values</p></td>
</tr>
<tr class="row-even"><td><p>Anti-Join</p></td>
<td><p>B - (A ∩ B)</p></td>
<td><p>Rows from B without matching values in A</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="multi-key-merging">
<h2><span class="section-number">5.9.6. </span>Multi-Key Merging<a class="headerlink" href="#multi-key-merging" title="Link to this heading">#</a></h2>
<p>You can merge DataFrames on multiple columns by passing a list of column names to the <code class="docutils literal notranslate"><span class="pre">on</span></code> parameter. This allows you to combine data based on multiple keys, ensuring that only rows with matching values in all specified columns are merged.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Create the first DataFrame</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
                    <span class="p">})</span>

<span class="c1"># Create the second DataFrame</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">]</span>
                    <span class="p">})</span>

<span class="c1"># Display the first DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

<span class="c1"># Display the second DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Merge the DataFrames based on the common keys &#39;key1&#39; and &#39;key2&#39;</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">])</span>

<span class="c1"># Display the merged DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merged DataFrame:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>X</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>Y</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>Z</td>
      <td>30</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df2:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B</td>
      <td>Y</td>
      <td>40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>C</td>
      <td>Z</td>
      <td>50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>D</td>
      <td>W</td>
      <td>60</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged DataFrame:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>value_x</th>
      <th>value_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B</td>
      <td>Y</td>
      <td>20</td>
      <td>40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>C</td>
      <td>Z</td>
      <td>30</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The resulting DataFrame contains only the rows where both ‘key1’ and ‘key2’ values are common between <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code>. It shows the corresponding values from both DataFrames in separate columns (‘value_x’ and ‘value_y’).</p>
</section>
<section id="specifying-left-and-right-prefixes">
<h2><span class="section-number">5.9.7. </span>Specifying Left and Right Prefixes<a class="headerlink" href="#specifying-left-and-right-prefixes" title="Link to this heading">#</a></h2>
<p>When merging DataFrames with overlapping column names, you can specify suffixes to differentiate them. This is particularly useful to avoid confusion and ensure clarity in the resulting DataFrame.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_left&#39;</span><span class="p">,</span> <span class="s1">&#39;_right&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_left&#39;</span><span class="p">,</span> <span class="s1">&#39;_right&#39;</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>value_left</th>
      <th>value_right</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B</td>
      <td>Y</td>
      <td>20</td>
      <td>40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>C</td>
      <td>Z</td>
      <td>30</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In this example, the resulting DataFrame will have columns with suffixes <code class="docutils literal notranslate"><span class="pre">_left</span></code> and <code class="docutils literal notranslate"><span class="pre">_right</span></code> to distinguish between the overlapping column names from <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code>.</p>
</section>
<section id="merging-on-index">
<h2><span class="section-number">5.9.8. </span>Merging on Index<a class="headerlink" href="#merging-on-index" title="Link to this heading">#</a></h2>
<p>You can merge DataFrames based on their indices using the <code class="docutils literal notranslate"><span class="pre">left_index</span></code> and <code class="docutils literal notranslate"><span class="pre">right_index</span></code> parameters. This is useful when the indices of the DataFrames contain the keys you want to merge on.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Assuming df1 and df2 are already defined</span>

<span class="c1"># Set the index of df1 to &#39;key1&#39;</span>
<span class="n">df1</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Set the index of df2 to &#39;key1&#39;</span>
<span class="n">df2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Merge the DataFrames based on their index (key1)</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Display the merged DataFrame</span>
<span class="n">display</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key2_x</th>
      <th>value_x</th>
      <th>key2_y</th>
      <th>value_y</th>
    </tr>
    <tr>
      <th>key1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>B</th>
      <td>Y</td>
      <td>20</td>
      <td>Y</td>
      <td>40</td>
    </tr>
    <tr>
      <th>C</th>
      <td>Z</td>
      <td>30</td>
      <td>Z</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In this example, the DataFrames <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code> are merged based on their indices, which are set to ‘key1’. The resulting DataFrame contains rows where the indices match in both DataFrames, combining the corresponding values from each DataFrame.</p>
</section>
<section id="merging-and-filtering-dataframes-in-pandas-using-merge-and-query">
<h2><span class="section-number">5.9.9. </span>Merging and Filtering DataFrames in Pandas using merge() and query()<a class="headerlink" href="#merging-and-filtering-dataframes-in-pandas-using-merge-and-query" title="Link to this heading">#</a></h2>
<p>In Pandas, the <code class="docutils literal notranslate"><span class="pre">merge()</span></code> function is used to combine two or more DataFrames based on a common column or index. The <code class="docutils literal notranslate"><span class="pre">query()</span></code> function is used to filter rows from a DataFrame based on a given condition. Although you can use both functions separately, there might be scenarios where you want to merge DataFrames and then filter the result using a query <span id="id3">[<a class="reference internal" href="../References.html#id51" title="Pandas Developers. Pandas documentation. https://pandas.pydata.org/docs/, 2023. [Online; accessed 01-August-2023].">Pandas Developers, 2023</a>]</span>.</p>
<p><font color='Blue'><b>Example:</b></font> Let’s assume we have two DataFrames, <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code>, and we want to merge them based on a common column, and then filter the merged result using a query condition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Sample data for df1</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="s1">&#39;Value1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

<span class="c1"># Sample data for df2</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                    <span class="s1">&#39;Value2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Merge the two DataFrames on the &#39;ID&#39; column using an inner join</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merged:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>

<span class="c1"># Filter the merged DataFrame using the query function</span>
<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Value1 &gt; 15 and Value2 &lt; 400&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtered:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df2:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>300</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>400</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>500</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>600</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>700</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
      <th>Value2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>10</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>20</td>
      <td>200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>30</td>
      <td>300</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>40</td>
      <td>400</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filtered:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
      <th>Value2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>20</td>
      <td>200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>30</td>
      <td>300</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In this example, we first create two DataFrames, <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code>, with a common column ‘ID’. We then merge these DataFrames on the ‘ID’ column using an inner join, which retains only the rows with matching ‘ID’ values in both DataFrames. After merging, we use the <code class="docutils literal notranslate"><span class="pre">query()</span></code> function to filter the merged DataFrame based on the condition that ‘Value1’ is greater than 15 and ‘Value2’ is less than 400. The resulting DataFrame contains only the rows that meet these criteria.</p>
</section>
<section id="semi-join-and-anti-join">
<h2><span class="section-number">5.9.10. </span>Semi-join and Anti-join<a class="headerlink" href="#semi-join-and-anti-join" title="Link to this heading">#</a></h2>
<p>Semi-join and anti-join are concepts in relational database management systems that involve combining two tables based on a common column but with specific filtering conditions. These concepts are useful for filtering and retrieving rows that meet certain criteria while excluding others.<span id="id4">[<a class="reference internal" href="../References.html#id172" title="J. Rioux. Data Analysis with Python and PySpark. Manning, 2022. ISBN 9781617297205. URL: https://books.google.ca/books?id=4ytfEAAAQBAJ.">Rioux, 2022</a>, <a class="reference internal" href="../References.html#id51" title="Pandas Developers. Pandas documentation. https://pandas.pydata.org/docs/, 2023. [Online; accessed 01-August-2023].">Pandas Developers, 2023</a>]</span>.</p>
<figure class="align-center" id="id9">
<a class="reference internal image-reference" href="../_images/semi_join.jpg"><img alt="../_images/semi_join.jpg" src="../_images/semi_join.jpg" style="width: 450px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.22 </span><span class="caption-text">Semi join and Anti-join</span><a class="headerlink" href="#id9" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ol class="arabic simple">
<li><p><strong>Semi-Join</strong>:
A semi-join is a type of join operation that returns rows from the first table that match the condition in the second table. In other words, it selects rows from one table where there is a match in the other table based on a specified column. However, unlike a regular join, only the columns from the first table are included in the result <span id="id5">[<a class="reference internal" href="../References.html#id172" title="J. Rioux. Data Analysis with Python and PySpark. Manning, 2022. ISBN 9781617297205. URL: https://books.google.ca/books?id=4ytfEAAAQBAJ.">Rioux, 2022</a>, <a class="reference internal" href="../References.html#id51" title="Pandas Developers. Pandas documentation. https://pandas.pydata.org/docs/, 2023. [Online; accessed 01-August-2023].">Pandas Developers, 2023</a>]</span>.</p></li>
<li><p><strong>Anti-Join</strong>:
An anti-join, also known as an anti-semi-join or difference join, is the opposite of a semi-join. It returns rows from the first table that do not have a match in the second table based on a specified column. Essentially, it filters out rows from the first table that meet a certain condition found in the second table <span id="id6">[<a class="reference internal" href="../References.html#id172" title="J. Rioux. Data Analysis with Python and PySpark. Manning, 2022. ISBN 9781617297205. URL: https://books.google.ca/books?id=4ytfEAAAQBAJ.">Rioux, 2022</a>, <a class="reference internal" href="../References.html#id51" title="Pandas Developers. Pandas documentation. https://pandas.pydata.org/docs/, 2023. [Online; accessed 01-August-2023].">Pandas Developers, 2023</a>]</span>.</p></li>
</ol>
<div class="important admonition">
<p class="admonition-title">Remark</p>
<ul class="simple">
<li><p>Semi-joins are typically used to filter data based on a condition present in another table.</p></li>
<li><p>Anti-joins are useful for finding records that are not present in another table or for excluding certain records that meet a certain criterion.</p></li>
</ul>
</div>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Assuming df1 and df2 are already defined</span>

<span class="c1"># Print and display df1</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>

<span class="c1"># Print and display df2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;df2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="c1"># Semi-Join: Get rows from df1 that have matching IDs in df2</span>
<span class="n">semi_join_result</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])]</span>

<span class="c1"># Anti-Join: Get rows from df1 that do not have matching IDs in df2</span>
<span class="n">anti_join_result</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="o">~</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])]</span>

<span class="c1"># Print Semi-Join Result</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Semi-Join Result:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">semi_join_result</span><span class="p">)</span>

<span class="c1"># Print Anti-Join Result</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Anti-Join Result:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">anti_join_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df1:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df2:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>300</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>400</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>500</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>600</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>700</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Semi-Join Result:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Anti-Join Result:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In SQL, you can use the <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> (for semi-join) and <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">IN</span></code> or <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">EXISTS</span></code> (for anti-join) constructs to achieve these types of joins.</p>
<p>In Pandas, you can simulate these types of joins using various methods. For example, to perform a semi-join, you could use the <code class="docutils literal notranslate"><span class="pre">merge()</span></code> function with the desired <code class="docutils literal notranslate"><span class="pre">how</span></code> parameter and then select the columns you want. For an anti-join, you could use the <code class="docutils literal notranslate"><span class="pre">merge()</span></code> function with the <code class="docutils literal notranslate"><span class="pre">indicator</span></code> parameter and then filter out the matching rows <span id="id7">[<a class="reference internal" href="../References.html#id172" title="J. Rioux. Data Analysis with Python and PySpark. Manning, 2022. ISBN 9781617297205. URL: https://books.google.ca/books?id=4ytfEAAAQBAJ.">Rioux, 2022</a>, <a class="reference internal" href="../References.html#id51" title="Pandas Developers. Pandas documentation. https://pandas.pydata.org/docs/, 2023. [Online; accessed 01-August-2023].">Pandas Developers, 2023</a>]</span>.</p>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Semi Join: Customers who have made orders</span>
<span class="n">semi_join_df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">semi_join_df</span> <span class="o">=</span> <span class="n">semi_join_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;_merge == &quot;both&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;_merge&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Semi-Join Result:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">semi_join_df</span><span class="p">)</span>

<span class="c1"># Anti Join: Customers who have not made orders</span>
<span class="n">anti_join_df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">anti_join_df</span> <span class="o">=</span> <span class="n">anti_join_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;_merge == &quot;left_only&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;_merge&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Anti-Join Result:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">anti_join_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Semi-Join Result:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Anti-Join Result:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Value1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-comparison-with-other-merge-types admonition">
<p class="admonition-title">Comparison with Other Merge Types</p>
<ul class="simple">
<li><p><strong>Inner Join</strong>: Returns only the rows with matching keys in both DataFrames. Similar to a semi-join but includes columns from both DataFrames.</p></li>
<li><p><strong>Left Join</strong>: Returns all rows from the left DataFrame and matching rows from the right DataFrame. Non-matching rows from the right DataFrame are filled with <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p></li>
<li><p><strong>Right Join</strong>: Returns all rows from the right DataFrame and matching rows from the left DataFrame. Non-matching rows from the left DataFrame are filled with <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p></li>
<li><p><strong>Outer Join</strong>: Returns all rows from both DataFrames, filling in <code class="docutils literal notranslate"><span class="pre">NaN</span></code> where there are no matches. This is more inclusive than a semi-join or anti-join.</p></li>
</ul>
<p>Semi-joins and anti-joins are more specialized operations that focus on filtering data based on the presence or absence of matching keys in another DataFrame, whereas the standard merge operations (inner, left, right, outer) are used to combine data from multiple DataFrames in various ways.</p>
</div>
</section>
<section id="merge-on-nearest-key">
<h2><span class="section-number">5.9.11. </span>Merge on Nearest Key<a class="headerlink" href="#merge-on-nearest-key" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">pd.merge_asof()</span></code> function in Pandas is used to perform a merge based on the nearest key, particularly for ordered data. It’s often used when you want to match records in two datasets based on a key column, but the values in the key column <strong>may not match exactly</strong>. Instead of requiring exact matches, this function allows you to match the nearest key values within a specified tolerance <span id="id8">[<a class="reference internal" href="../References.html#id139" title="Wes McKinney and others. Data structures for statistical computing in python. In Proceedings of the 9th Python in Science Conference, volume 445, 51–56. Austin, TX, 2010.">McKinney and others, 2010</a>, <a class="reference internal" href="../References.html#id51" title="Pandas Developers. Pandas documentation. https://pandas.pydata.org/docs/, 2023. [Online; accessed 01-August-2023].">Pandas Developers, 2023</a>]</span>.</p>
<p>The syntax of the <code class="docutils literal notranslate"><span class="pre">pd.merge_asof()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge_asof</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">left_on</span><span class="p">,</span> <span class="n">right_on</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">left</span></code>: The left DataFrame to merge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">right</span></code>: The right DataFrame to merge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code>: The column name to use as the key for merging. It must be present in both DataFrames.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by</span></code>: A list of columns to be used as additional keys for merging.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">left_on</span></code>, <code class="docutils literal notranslate"><span class="pre">right_on</span></code>: Columns from the left and right DataFrames to use as keys instead of the <code class="docutils literal notranslate"><span class="pre">on</span></code> parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">left_index</span></code>, <code class="docutils literal notranslate"><span class="pre">right_index</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, use the index of the left or right DataFrame as a key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">direction</span></code>: Specifies whether to search for the nearest key in ‘backward’ or ‘forward’ direction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tolerance</span></code>: The maximum allowable difference between key values for a successful match.</p></li>
</ul>
<p><font color='Blue'><b>Example:</b></font> An explanation of the parameters using an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Creating stock price and economic data DataFrames</span>
<span class="n">stock_prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;2023-01-01 09:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-01 09:15:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-01 09:30:00&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;stock_symbol&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">150.20</span><span class="p">,</span> <span class="mf">152.40</span><span class="p">,</span> <span class="mf">153.10</span><span class="p">]</span>
                             <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stock Prices:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">stock_prices</span><span class="p">)</span>

<span class="n">economic_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;2023-01-01 09:05:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-01 09:25:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-01 09:40:00&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;indicator&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GDP&#39;</span><span class="p">,</span> <span class="s1">&#39;Unemployment&#39;</span><span class="p">,</span> <span class="s1">&#39;Inflation&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">]</span>
                              <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Economic Data:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">economic_data</span><span class="p">)</span>

<span class="c1"># Converting timestamps to datetime format</span>
<span class="n">stock_prices</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">stock_prices</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
<span class="n">economic_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">economic_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>

<span class="c1"># Merging based on the nearest key</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge_asof</span><span class="p">(</span><span class="n">stock_prices</span><span class="p">,</span> <span class="n">economic_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>

<span class="c1"># Displaying the result</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Merged DataFrame:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stock Prices:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>stock_symbol</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-01-01 09:00:00</td>
      <td>AAPL</td>
      <td>150.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-01-01 09:15:00</td>
      <td>AAPL</td>
      <td>152.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-01-01 09:30:00</td>
      <td>AAPL</td>
      <td>153.1</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Economic Data:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>indicator</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-01-01 09:05:00</td>
      <td>GDP</td>
      <td>2.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-01-01 09:25:00</td>
      <td>Unemployment</td>
      <td>4.8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-01-01 09:40:00</td>
      <td>Inflation</td>
      <td>2.2</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged DataFrame:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>stock_symbol</th>
      <th>price</th>
      <th>indicator</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-01-01 09:00:00</td>
      <td>AAPL</td>
      <td>150.2</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-01-01 09:15:00</td>
      <td>AAPL</td>
      <td>152.4</td>
      <td>GDP</td>
      <td>2.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-01-01 09:30:00</td>
      <td>AAPL</td>
      <td>153.1</td>
      <td>Unemployment</td>
      <td>4.8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="important admonition">
<p class="admonition-title">Remark</p>
<p>The choice between using <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code> and <code class="docutils literal notranslate"><span class="pre">pd.merge_asof</span></code> depends on the specific use case and the desired merging behavior. Both methods are useful for merging datasets, but they have different purposes and are suited for different scenarios.</p>
<p><code class="docutils literal notranslate"><span class="pre">pd.merge</span></code> is generally used for precise merges on exact match conditions, including merges on columns other than datetime. It provides options for different types of joins (e.g., inner, outer, left, right), and it requires an exact match on the specified merge column(s).</p>
<p><code class="docutils literal notranslate"><span class="pre">pd.merge_asof</span></code>, on the other hand, is specifically designed for merging based on nearest key(s) with an optional tolerance. This method is particularly useful when you want to merge datasets based on datetime columns, and you want to match rows within a certain time range (tolerance) rather than requiring an exact match.</p>
<p>Here’s an example of when you might prefer to use <code class="docutils literal notranslate"><span class="pre">pd.merge_asof</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Sample DataFrames with datetime columns</span>
<span class="n">data1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2023-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-02-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-04-01&quot;</span><span class="p">],</span>
    <span class="s2">&quot;value1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>

<span class="n">data2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2023-01-15&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-03-15&quot;</span><span class="p">],</span>
    <span class="s2">&quot;value2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>

<span class="c1"># Convert the &#39;datetime&#39; column to datetime format</span>
<span class="n">df1</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span>

<span class="c1"># Merge based on nearest datetime with a tolerance</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge_asof</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>

<span class="c1"># Print the merged DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">datetime</span>  <span class="n">value1</span>  <span class="n">value2</span>
<span class="mi">0</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>      <span class="mi">10</span>     <span class="n">NaN</span>
<span class="mi">1</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span>      <span class="mi">20</span>     <span class="n">NaN</span>
<span class="mi">2</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span>      <span class="mi">30</span>   <span class="mf">200.0</span>
<span class="mi">3</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span>      <span class="mi">40</span>     <span class="n">NaN</span>
</pre></div>
</div>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">pd.merge_asof</span></code> is used to merge <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code> based on the “datetime” column with a tolerance of 15 days. This means rows from <code class="docutils literal notranslate"><span class="pre">df2</span></code> will be matched to the nearest row in <code class="docutils literal notranslate"><span class="pre">df1</span></code> based on the datetime column, allowing for a difference of up to 15 days.</p>
</div>
</section>
<section id="categorical-merging">
<h2><span class="section-number">5.9.12. </span>Categorical Merging<a class="headerlink" href="#categorical-merging" title="Link to this heading">#</a></h2>
<p>If your data has categorical variables, you can use categorical merging for better performance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;category_column&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><font color='Blue'><b>Example:</b></font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Generating example data</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">)</span>  <span class="c1"># Number of rows</span>
<span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
    <span class="s1">&#39;category_column&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="p">})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;category_column&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">),</span>
    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># Regular merging (without categorical data type)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">regular_merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;category_column&#39;</span><span class="p">)</span>
<span class="n">regular_merge_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Converting the &#39;category_column&#39; to categorical data type</span>
<span class="n">df1</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;category_column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="c1"># Categorical merging</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">categorical_merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;category_column&#39;</span><span class="p">)</span>
<span class="n">categorical_merge_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Displaying results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Regular Merge Time: </span><span class="si">{</span><span class="n">regular_merge_time</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Categorical Merge Time: </span><span class="si">{</span><span class="n">categorical_merge_time</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regular Merge Time: 0.674
Categorical Merge Time: 0.561
</pre></div>
</div>
</div>
</div>
<p>In this example, we generate two DataFrames, df1 and df2, with a categorical column ‘category_column’. We then compare the performance of regular merging versus categorical merging.</p>
<p>Categorical merging can offer better performance, especially when dealing with large datasets, because categorical data types use integer-based codes internally, reducing memory usage and speeding up comparison operations. As a result, merging operations involving categorical columns can be more efficient.</p>
<p>Remember that the actual performance gain will depend on various factors including the size of your dataset and the specific operations being performed. Always consider the benefits of categorical data types based on your use case.</p>
<p>These merging techniques provide more flexibility and control over how you combine datasets using Pandas. Be sure to refer to the Pandas documentation for detailed information on these methods and their parameters: <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter_05"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ENDG440_C05S08.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.8. </span>Strategies for Handling Missing Categorical Data in Pandas</p>
      </div>
    </a>
    <a class="right-next"
       href="ENDG440_C05S10.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.10. </span>Pandas <code class="docutils literal notranslate"><span class="pre">join</span></code> and <code class="docutils literal notranslate"><span class="pre">concat</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-merge">5.9.1. Inner Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outer-merge">5.9.2. Outer Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#left-merge">5.9.3. Left Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#right-merge">5.9.4. Right Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-join">5.9.5. Cross Join</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-key-merging">5.9.6. Multi-Key Merging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-left-and-right-prefixes">5.9.7. Specifying Left and Right Prefixes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-on-index">5.9.8. Merging on Index</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-and-filtering-dataframes-in-pandas-using-merge-and-query">5.9.9. Merging and Filtering DataFrames in Pandas using merge() and query()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-join-and-anti-join">5.9.10. Semi-join and Anti-join</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-on-nearest-key">5.9.11. Merge on Nearest Key</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-merging">5.9.12. Categorical Merging</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Hatef Dastour
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>